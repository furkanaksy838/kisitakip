sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/export/Spreadsheet"],function(e,t,o,i){"use strict";return e.extend("kisitakip.project1.controller.success",{onInit:async function(){const e=JSON.parse(localStorage.getItem("importedData")||"[]");const i=this.getOwnerComponent().getModel();for(let t=0;t<e.length;t++){const o=e[t].ID;try{const a=i.bindContext(`/People(${o})`);const n=await a.requestObject();e[t].Age=n?.Age||"N/A"}catch(o){e[t].Age="N/A"}}const a=new t({items:e});const n=new t({Name:"",Birthday:"",Age:"","Cıty":"",Position:"",HireDate:"",TerminationDate:""});this.getView().setModel(a,"editModel");this.getView().setModel(n,"filterModel");const r=new t({Person_ID:"",StartDate:null,EndDate:null,Type:"",Reason:""});this.getView().setModel(r,"absenceModel");o.show("Veriler başarıyla kaydedildi!",{duration:3e3,my:"begin bottom",at:"begin bottom"})},onSearch:async function(e){const t=e.getParameter("value").trim();const o=this.getView().getModel();const i=o.bindList("/People",null,null,null,{$select:"ID,Name,Birthday,Age,City,Position,HireDate,Avatar,TerminationDate"});const a=await i.requestContexts(0,1e3);const n=a.map(e=>e.getObject());if(!t){this.getView().getModel("editModel").setProperty("/items",n);return}const r=n.filter(e=>{const o=e.ID!==undefined&&e.ID.toString()===t;const i=e.Name&&e.Name.toLowerCase().includes(t.toLowerCase());const a=e.Birthday&&e.Birthday.toLowerCase().includes(t.toLowerCase());const n=e.Age!==undefined&&e.Age.toString().includes(t);const r=e.City&&e.City.toLowerCase().includes(t.toLowerCase());const s=e.HireDate&&e.HireDate.toLowerCase().includes(t.toLowerCase());const l=e.Position&&e.Position.toLowerCase().includes(t.toLowerCase());return o||i||a||n||r||s||l});if(r.length===0){sap.m.MessageToast.show("Eşleşen kayıt bulunamadı.")}this.getView().getModel("editModel").setProperty("/items",r)},onBirthdayChange:function(e){const t=e.getSource().getDateValue();const o=new Date;if(!t)return;const a=new Date(t.setHours(0,0,0,0));const n=new Date(o.setHours(0,0,0,0));if(a>n){i.error("Gelecekte bir doğum tarihi giremezsiniz!");e.getSource().setValue("");return}let r=n.getFullYear()-a.getFullYear();const s=n.getMonth()-a.getMonth();if(s<0||s===0&&n.getDate()<a.getDate()){r--}const l=e.getSource().getBindingContext("editModel").getPath();const c=this.getView().getModel("editModel");c.setProperty(l+"/Birthday",a.toISOString().split("T")[0]);c.setProperty(l+"/Age",r);c.setProperty(l+"/_dirty",true)},onDelete:function(e){var t=e.getSource();var a=t.getBindingContext("editModel");var n=a.getObject().ID;var r=this.getView().getModel("editModel");var s=r.getProperty("/items");i.confirm("ID "+n+" olan kaydı silmek istiyor musunuz?",{onClose:e=>{if(e!==i.Action.OK)return;var t=s.findIndex(function(e){return e.ID==n});if(t>-1){s.splice(t,1);r.setProperty("/items",s)}var a=this.getView().getModel();var l=a.bindList("/People");l.requestContexts(0,1e3).then(e=>{var t=e.find(e=>e.getObject().ID==n);if(t){t.delete().then(()=>{o.show("Veri başarıyla silindi.")}).catch(e=>{i.error("Veri silinirken hata oluştu.");console.error(e)})}else{i.error("Silinecek kayıt HANA'da bulunamadı.")}}).catch(e=>{i.error("Bağlam alınırken hata oluştu.");console.error(e)})}})},onUpdate:async function(e){const t=this.getView().getModel("editModel");const i=this.getView().getModel();const a=e.getSource().getBindingContext("editModel").getPath();const n=t.getProperty(a);const r="/People("+n.ID+")";const s=parseInt(n.Age,10);const l=new Date;const c=new Date(l.setFullYear(l.getFullYear()-s));const d=c.toISOString().split("T")[0];const g=i.bindContext(r,null,{$$updateGroupId:"auto"});await g.requestObject();const u=g.getBoundContext();const h=parseInt(u.getProperty("Age"),10);if(s===h){t.setProperty(a+"/_dirty",false);t.checkUpdate(true);o.show("Yaşta değişiklik yapılmadı.");return}u.setProperty("Age",s);u.setProperty("Birthday",d);await i.submitBatch("auto");o.show("Yaş ve doğum tarihi başarıyla güncellendi.");t.setProperty(a+"/_dirty",false);t.checkUpdate(true)},onAdd:function(){const e=this.byId("inputID").getValue();const t=this.byId("inputName").getValue();const a=this.byId("inputBirthday").getDateValue();const n=this.byId("inputAvatar").getValue();const r=this.byId("inputCity").getValue();const s=this.byId("inputPosition").getValue();const l=this.byId("inputHireDate").getDateValue();if(!e||!t||!a||!n||!r||!s||!l){o.show("Lütfen tüm alanları doldurun.");return}const c=new Date;const d=new Date(a.setHours(0,0,0,0));const g=new Date(l.setHours(0,0,0,0));if(d>c||g>c){i.error("Gelecekte bir tarih giremezsiniz!");return}let u=c.getFullYear()-d.getFullYear();const h=c.getMonth()-d.getMonth();if(h<0||h===0&&c.getDate()<d.getDate()){u--}const y=d.toISOString().split("T")[0];const p=g.toISOString().split("T")[0];const b=this.getView().getModel();const m=b.bindList("/People");const C={ID:e,Name:t,Birthday:y,Age:u,Avatar:n,City:r,Position:s,HireDate:p};const w=m.create(C);w.created().then(()=>{o.show("Kullanıcı başarıyla eklendi!");const e=this.getView().getModel("editModel");const t=e.getProperty("/items");t.push(w.getObject());e.setProperty("/items",t);this.byId("inputID").setValue("");this.byId("inputName").setValue("");this.byId("inputBirthday").setDateValue(null);this.byId("inputAvatar").setValue("");this.byId("inputCity").setValue("");this.byId("inputPosition").setValue("");this.byId("inputHireDate").setDateValue(null);setTimeout(()=>{this._drawCharts()},200)}).catch(e=>{i.error("Hata: "+e.message)})},onSortAge:function(){const e=this.getView().getModel("editModel").getProperty("/items");const t=!this._bAgeSortAsc;this._bAgeSortAsc=t;e.sort((e,o)=>t?e.Age-o.Age:o.Age-e.Age);this.getView().getModel("editModel").setProperty("/items",e);const o=this.byId("IDGenTable");const i=o.getColumns()[2].getHeader().getItems()[1];i.setIcon(t?"sap-icon://sort-ascending":"sap-icon://sort-descending")},onExportToExcel:function(){const e=[{label:"ID",property:"ID"},{label:"Name",property:"Name"},{label:"Birthday",property:"Birthday"},{label:"Age",property:"Age"},{label:"City",property:"City"},{label:"Position",property:"Position"},{label:"Hire Date",property:"HireDate"}];const t=this.getView().getModel("editModel").getProperty("/items");const o={workbook:{columns:e},dataSource:t,fileName:"KayitliKisiler.xlsx"};const i=new sap.ui.export.Spreadsheet(o);i.build().then(()=>{sap.m.MessageBox.information("Excel başarıyla indirildi. Excel Online'da açmak ister misiniz?",{actions:["Aç","Kapat"],emphasizedAction:"Aç",onClose:function(e){if(e==="Aç"){window.open("https://www.office.com/launch/excel","_blank")}}})}).catch(e=>{sap.m.MessageBox.error("Excel indirilemedi.");console.error(e)})},_drawCharts:function(){const e=this.byId("_IDGenTable");if(!e)return;const t=["ageChart","genderChart","birthYearChart","cityChart","positionChart","hireYearChart"];const o=t.every(e=>document.getElementById(e));if(!o){console.warn("Bazı canvas elementleri DOM'da bulunamadı.");return}const i=e.getItems();const a={};const n={};const r={};const s={};const l={};const c={};const d=e=>{const t=["Zeynep","Elif","Ayşe","Fatma","Hatice"];const o=["Mehmet","Emre","Can","Ahmet","Ali","Furkan Aksoy "];const i=e?.split(" ")[0];if(t.includes(i))return"Kadın";if(o.includes(i))return"Erkek";return"Bilinmiyor"};i.forEach(e=>{const t=e.getBindingContext("editModel")?.getObject();if(!t||!t.Birthday||!t.Name||!t.City||!t.Position||!t.HireDate)return;const o=t.Age;const i=new Date(t.Birthday).getFullYear();const g=new Date(t.HireDate).getFullYear();const u=d(t.Name);const h=t.City;const y=t.Position;a[o]=(a[o]||0)+1;r[i]=(r[i]||0)+1;n[u]=(n[u]||0)+1;s[h]=(s[h]||0)+1;l[y]=(l[y]||0)+1;c[g]=(c[g]||0)+1});this.chartAge?.destroy();this.chartGender?.destroy();this.chartBirthYear?.destroy();this.chartCity?.destroy();this.chartPosition?.destroy();this.chartHireYear?.destroy();const g={options:{plugins:{title:{display:true}},scales:{y:{beginAtZero:true}}}};this.chartAge=new Chart(document.getElementById("ageChart"),{type:"bar",data:{labels:Object.keys(a),datasets:[{label:"Yaş Dağılımı",data:Object.values(a),backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},...g,options:{...g.options,plugins:{title:{display:true,text:"Yaş Dağılımı"}}}});this.chartGender=new Chart(document.getElementById("genderChart"),{type:"pie",data:{labels:Object.keys(n),datasets:[{label:"Cinsiyet Dağılımı",data:Object.values(n),backgroundColor:["#ff6384","#36a2eb","#cccccc"]}]},options:{plugins:{title:{display:true,text:"Cinsiyet Dağılımı"}}}});this.chartBirthYear=new Chart(document.getElementById("birthYearChart"),{type:"bar",data:{labels:Object.keys(r),datasets:[{label:"Doğum Yılı Dağılımı",data:Object.values(r),backgroundColor:"rgba(255, 159, 64, 0.5)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:1}]},...g,options:{...g.options,plugins:{title:{display:true,text:"Doğum Yılı Dağılımı"}}}});this.chartCity=new Chart(document.getElementById("cityChart"),{type:"bar",data:{labels:Object.keys(s),datasets:[{label:"Şehir Dağılımı",data:Object.values(s),backgroundColor:"rgba(75, 192, 192, 0.5)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},...g,options:{...g.options,plugins:{title:{display:true,text:"Şehir Dağılımı"}}}});if(Object.keys(l).length>0){this.chartPosition=new Chart(document.getElementById("positionChart"),{type:"bar",data:{labels:Object.keys(l),datasets:[{label:"Pozisyon Dağılımı",data:Object.values(l),backgroundColor:["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 206, 86, 0.5)","rgba(75, 192, 192, 0.5)","rgba(153, 102, 255, 0.5)","rgba(255, 159, 64, 0.5)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},...g,options:{...g.options,plugins:{title:{display:true,text:"Pozisyon Dağılımı"},legend:{display:false}}}})}this.chartHireYear=new Chart(document.getElementById("hireYearChart"),{type:"bar",data:{labels:Object.keys(c),datasets:[{label:"İşe Başlama Yılı",data:Object.values(c),backgroundColor:"rgba(153, 102, 255, 0.5)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]},...g,options:{...g.options,plugins:{title:{display:true,text:"İşe Başlama Yılı Dağılımı"}}}})},onStatsPanelExpand:function(e){const t=e.getParameter("expand");if(t){const e=this;setTimeout(function(){e._drawCharts();e.chartAge?.resize();e.chartGender?.resize();e.chartBirthYear?.resize();e.chartCity?.resize();e.chartPosition?.resize();e.chartHireYear?.resize()},500)}},onThemeChange:function(e){const t=e.getSource().getSelectedKey();sap.ui.getCore().applyTheme(t)},onAddAbsence:function(){const e=this.getView();const t=e.getModel();const a=e.getModel("absenceModel").getData();const n=this.byId("inputAbsenceStart").getDateValue();const r=this.byId("inputAbsenceEnd").getDateValue();const s=e=>e instanceof Date&&!isNaN(e);if(!a.ID){i.error("Lütfen bir ID girin.");return}if(!s(n)){i.error("Lütfen geçerli bir başlangıç tarihi girin.");return}if(!s(r)){i.error("Lütfen geçerli bir bitiş tarihi girin.");return}const l=t.bindList("/Absences",undefined,[],null,{$$groupId:"createGroup"});const c=l.create({ID:a.ID,Name:a.Name,StartDate:n.toISOString().split("T")[0],EndDate:r.toISOString().split("T")[0],Type:a.Type});c.created().then(()=>{o.show("İzin kaydı başarıyla eklendi!");e.getModel("absenceModel").setData({});t.refresh()}).catch(e=>{i.error("Hata oluştu: "+e.message)})},onDeleteAbsence:function(e){const t=this.getView().getModel();const a=e.getSource().getParent();const n=a.getBindingContext();if(!n){i.error("Silinecek kayıt bulunamadı.");return}i.confirm("Bu kaydı silmek istediğinizden emin misiniz?",{onClose:e=>{if(e==="OK"){n.delete().then(()=>{o.show("Kayıt başarıyla silindi.");t.refresh()}).catch(e=>{i.error("Silme hatası: "+e.message)})}}})},onToView3:function(){console.log("View3'e geçiliyor...");this.getOwnerComponent().getRouter().navTo("View3")},onFireTerminate:async function(e){const t=this.getView().getModel("editModel");const a=this.getView().getModel();const n=e.getSource().getBindingContext("editModel").getPath();const r=t.getProperty(n);const s=`/People(${r.ID})`;i.confirm("Bu kişiyi işten çıkarmak istiyor musunuz?",{onClose:async e=>{if(e!==i.Action.OK)return;const n=(new Date).toISOString().split("T")[0];try{const e=a.bindContext(s,null,{$$updateGroupId:"auto"});await e.requestObject();const i=e.getBoundContext();i.setProperty("TerminationDate",n);await a.submitBatch("auto");let l=t.getProperty("/items");const c=l.filter(e=>e.ID!==r.ID);t.setProperty("/items",[]);setTimeout(()=>{t.setProperty("/items",c)},0);o.show("Kişi işten çıkarıldı.")}catch(e){i.error("Veritabanı güncellenemedi: "+e.message);console.error("❌ PATCH hatası:",e)}}})},onBack:function(){this.getOwnerComponent().getRouter().navTo("View1")}})});
//# sourceMappingURL=Success.controller.js.map